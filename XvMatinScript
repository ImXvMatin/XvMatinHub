local player = game.Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- GUI Setup
local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
gui.Name = "XvMatinHub"
gui.ResetOnSpawn = false

local openBtn = Instance.new("TextButton", gui)
openBtn.Size = UDim2.new(0, 100, 0, 40)
openBtn.Position = UDim2.new(0, 10, 0, 10)
openBtn.Text = "Xv"
openBtn.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
openBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
openBtn.Font = Enum.Font.GothamBold
openBtn.TextSize = 20

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 220, 0, 240)
frame.Position = UDim2.new(0, 10, 0, 60)
frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
frame.Visible = false

openBtn.MouseButton1Click:Connect(function()
	frame.Visible = not frame.Visible
end)

-- Button Factory
local function createButton(name, yPos)
	local btn = Instance.new("TextButton", frame)
	btn.Size = UDim2.new(0, 200, 0, 40)
	btn.Position = UDim2.new(0, 10, 0, yPos)
	btn.Text = name
	btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	btn.TextColor3 = Color3.fromRGB(255, 255, 255)
	btn.Font = Enum.Font.Gotham
	btn.TextSize = 18
	return btn
end

local flyBtn = createButton("Toggle Fly", 0.05)
local sitBtn = createButton("Toggle Sit", 0.30)
local sleepBtn = createButton("Toggle Sleep", 0.55)
local espBtn = createButton("Toggle ESP", 0.80)

-- Fly Logic
local flying = false
local speed = 3
local bv = nil
local direction = Vector3.zero

UIS.InputBegan:Connect(function(input)
	if input.KeyCode == Enum.KeyCode.W then direction = Vector3.new(0, 0, -1)
	elseif input.KeyCode == Enum.KeyCode.S then direction = Vector3.new(0, 0, 1)
	elseif input.KeyCode == Enum.KeyCode.A then direction = Vector3.new(-1, 0, 0)
	elseif input.KeyCode == Enum.KeyCode.D then direction = Vector3.new(1, 0, 0)
	elseif input.KeyCode == Enum.KeyCode.LeftShift then speed = 10
end)

UIS.InputEnded:Connect(function(input)
	if input.KeyCode == Enum.KeyCode.W or input.KeyCode == Enum.KeyCode.S or input.KeyCode == Enum.KeyCode.A or input.KeyCode == Enum.KeyCode.D then
		direction = Vector3.zero
	elseif input.KeyCode == Enum.KeyCode.LeftShift then speed = 3
end)

flyBtn.MouseButton1Click:Connect(function()
	flying = not flying
	if flying then
		bv = Instance.new("BodyVelocity", hrp)
		bv.Name = "FlyVelocity"
		bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
		bv.Velocity = Vector3.zero

		RunService.Heartbeat:Connect(function()
			if flying and bv then
				bv.Velocity = (hrp.CFrame:VectorToWorldSpace(direction)) * speed
			end
		end)
	else
		if bv then bv:Destroy() bv = nil end
	end
end)

-- Sit Logic
local sitting = false
sitBtn.MouseButton1Click:Connect(function()
	local hum = char:FindFirstChildOfClass("Humanoid")
	if hum then
		sitting = not sitting
		hum.Sit = sitting
	end
end)

-- Sleep Logic
local sleeping = false
local sleepAnim = Instance.new("Animation")
sleepAnim.AnimationId = "rbxassetid://282574440"
local sleepTrack = nil

sleepBtn.MouseButton1Click:Connect(function()
	local hum = char:FindFirstChildOfClass("Humanoid")
	if hum then
		if not sleeping then
			sleepTrack = hum:LoadAnimation(sleepAnim)
			sleepTrack:Play()
			sleeping = true
		else
			if sleepTrack then sleepTrack:Stop() end
			sleeping = false
		end
	end
end)

-- ESP Logic
local espEnabled = false
local espLabels = {}

espBtn.MouseButton1Click:Connect(function()
	espEnabled = not espEnabled
	if espEnabled then
		for _, plr in pairs(game.Players:GetPlayers()) do
			if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
				local label = Instance.new("TextLabel", gui)
				label.Name = "ESP_" .. plr.Name
				label.Size = UDim2.new(0, 200, 0, 20)
				label.BackgroundTransparency = 1
				label.TextColor3 = Color3.new(1, 0, 0)
				label.Font = Enum.Font.GothamBold
				label.TextSize = 14
				label.Text = "ðŸŽ¯ " .. plr.Name
				espLabels[plr.Name] = label

				RunService.RenderStepped:Connect(function()
					if espEnabled and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
						local pos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(plr.Character.HumanoidRootPart.Position)
						label.Position = UDim2.new(0, pos.X, 0, pos.Y)
						label.Visible = onScreen
					elseif label then
						label.Visible = false
					end
				end)
			end
		end
	else
		for _, lbl in pairs(espLabels) do
			lbl:Destroy()
		end
		espLabels = {}
	end
end)
